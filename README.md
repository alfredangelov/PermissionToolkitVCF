# Permission Toolkit for vSphere

A PowerShell 7.x toolkit for connecting to VMware vSphere, auditing permissions, and exporting results as a browsable HTML report.  
The toolkit is modular, uses a shared configuration, and includes scripts for environment initialization, configuration building, and validation.

## Features

- Connects to vSphere environments
- Audits and exports all permissions
- Generates browsable HTML reports
- Modular design for maintainability
- Centralized configuration management
- Environment initialization and configuration validation scripts
- Secure credential storage using PowerShell SecretManagement

## Project Structure

```plain text
.
├── Build-Configuration.ps1           # Script to build project-specific configuration
├── Initialize-Environment.ps1        # Script to initialize the environment
├── Permission-Toolkit.ps1            # Main entry point for the toolkit
├── Validate-Configuration.ps1        # Script to validate configuration and vCenter access
├── modules/
│   ├── Connect-VSphere.psm1          # Module for vSphere connection logic
│   ├── Export-HTML.Report.psm1       # Module for exporting HTML reports
│   ├── Get-Permissions.psm1          # Module for retrieving permissions
│   └── Utils.psm1                    # Utility functions
├── shared/
│   └── Configuration-template.psd1            # Shared configuration file (gitignored)
└── .gitignore
```

## Getting Started

1. **Initialize the Environment**

   ```powershell
   ./Initialize-Environment.ps1
   ```

2. **Build Configuration**

   ```powershell
   ./Build-Configuration.ps1
   ```

   This script will prompt you for all required configuration values and securely store credentials if needed.

3. **Validate Configuration**

   ```powershell
   ./Validate-Configuration.ps1
   ```

   This will check your configuration, test vCenter connectivity, and verify credentials.

4. **Run the Toolkit**

   ```powershell
   ./Permission-Toolkit.ps1
   ```

## Configuration

A template configuration file is provided as `shared/Configuration-template.psd1`.  
**Do not edit this file directly.**  
Instead, copy it to `shared/Configuration.psd1` and edit your settings there.  
The `Configuration.psd1` file is gitignored and will not be tracked in version control.

Example:

```powershell
@{
    dataCenter = 'MainDC'
    DryRun = 'True'
    ExportGlobalPermissions = 'True'
    ExportNormalPermissions = 'True'
    SourceServerHost = 'vcenter.domain.com'
    SourceServerPassword = '<ToBeSetOrStoredInVault>'
    SourceServerUsername = '<ToBeSetOrStoredInVault>'
}
```

> **Note:** The toolkit will prompt you to create and fill out `Configuration.psd1` if it does not exist.

## Credential Management

Credentials are securely stored using PowerShell SecretManagement.  
If not present, you will be prompted to enter and store them during configuration.
